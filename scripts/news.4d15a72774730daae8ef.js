!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){"use strict";function r(e){return`${e.getFullYear().toString()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}n.d(t,"d",(function(){return s})),n.d(t,"b",(function(){return a})),n.d(t,"h",(function(){return o})),n.d(t,"g",(function(){return i})),n.d(t,"i",(function(){return c})),n.d(t,"c",(function(){return b})),n.d(t,"e",(function(){return v})),n.d(t,"n",(function(){return l})),n.d(t,"o",(function(){return u})),n.d(t,"a",(function(){return h})),n.d(t,"k",(function(){return d})),n.d(t,"j",(function(){return f})),n.d(t,"f",(function(){return g})),n.d(t,"m",(function(){return _})),n.d(t,"l",(function(){return p})),n.d(t,"p",(function(){return m})),n.d(t,"q",(function(){return y})),n.d(t,"r",(function(){return w}));const s=document.querySelector(".header__show-menu-btn"),a=document.querySelector(".header"),o=(document.querySelector("#logout-button"),document.querySelector(".popup-signup")),i=document.querySelector(".popup-signin"),c=document.querySelector(".popup-success"),l=(document.querySelector(".search__box"),document.querySelector(".search__bar")),u=document.querySelector(".search__button"),d=document.querySelector(".results"),h=document.querySelector(".cards"),_=document.querySelector(".results__success"),p=document.querySelector(".results__error"),f=document.querySelector(".preloader"),g=document.querySelector(".not-found"),m=document.querySelector(".results__show-button"),b={serverUrl:"https://api.news-aggregator.tk"},v={serverUrl:"https://praktikum.tk/news/v2/everything",apiKey:"8ed261fbbab34d4a85c2193047cedd72",userInput:l,today:r(new Date),aWeekAgo:function(){const e=new Date;return e.setDate(e.getDate()-7),r(e)}()},w=document.querySelector(".saved-articles"),y=JSON.parse(localStorage.getItem("user"))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(){this._handlers=[]}_setHandlers(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(e=>this._setEventListener(e))}_setEventListener(e){let{element:t,event:n,callback:r}=e;t.addEventListener(n,r),this._handlers.push({element:t,event:n,callback:r})}removeEventListeners(){this._handlers.forEach(e=>{let{element:t,event:n,callback:r}=e;t.removeEventListener(n,r)})}}},function(e,t,n){"use strict";function r(e){return e[0].toUpperCase()+e.slice(1).toLowerCase()}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e){this.serverUrl=e.serverUrl}signup(e,t,n,r,s){return fetch(`${this.serverUrl}/signup`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t,name:n})}).then(e=>e.ok?e.json():e.text().then(()=>{if(400===e.status)throw"Такой пользователь уже есть";throw"На сервере произошла ошибка"})).then(e=>(s(),e)).catch(e=>{r(e)})}signin(e,t,n,r){return fetch(`${this.serverUrl}/signin`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})}).then(e=>e.ok?e:e.text().then(()=>{if(401===e.status||400===e.status)throw"Ошибка авторизации, проверьте введённые данные";throw"На сервере произошла ошибка"})).then(e=>this.getUserData()).then(e=>{localStorage.setItem("user",JSON.stringify({name:e.name,email:e.email})),r(e.name)}).catch(e=>n(e))}getUserData(){return fetch(`${this.serverUrl}/users/me`,{credentials:"include",headers:{"Content-Type":"application/json"}}).then(e=>e.ok?e.json():Promise.reject(e.statusText)).then(e=>e).catch(e=>e)}getArticles(){return fetch(`${this.serverUrl}/articles`,{credentials:"include",headers:{"Content-Type":"application/json"}}).then(e=>e.ok?e.json():Promise.reject(e.statusText)).then(e=>e).catch(e=>console.log(e))}createArticle(e,t){return fetch(`${this.serverUrl}/articles`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyword:e.keyword,title:e.title,text:e.text,date:e.date,source:e.source,link:e.link,image:e.image})}).then(e=>e.ok?e.json():Promise.reject(e.statusText)).then(e=>{t(e)}).catch(e=>console.log(e))}removeArticle(e,t,n){return fetch(`${this.serverUrl}/articles/${e}`,{method:"DELETE",credentials:"include"}).then(e=>e.ok?e.json():Promise.reject(e.status)).then(e=>this.getArticles()).then(e=>{t?t(e):n()}).catch(e=>console.log(e))}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0),s=n(2);class a{constructor(e){this.user=e,this.renderResultsMarkUp=this.renderResultsMarkUp.bind(this)}_getResultsMarkUp(e){const t=function(e){const t={};return e.forEach((function(e){t[e]=0})),e.filter((function(e){return 1==++t[e]})).sort((function(e,n){return t[n]-t[e]}))}(e.map(e=>Object(s.a)(e.keyword)));var n;return`\n      <h2 class="saved-articles__header">Сохранённые статьи</h2>\n      <p class="saved-articles__counter">${this.user.name}, у вас ${e.length} ${n=e.length,(n=Math.abs(n%100))>20&&(n%=10),["cохранённая статья","cохранённые статьи","cохранённых статей"][(n>4||0===n)+(1!==n)]}</p>\n      ${this.renderKeywords(t)}\n    `}renderKeywords(e){return e.length<=3?`<p class="saved-articles__keywords">По ключевым словам: <b id="keywords-showed">${e.join(", ")}</b>`:`\n      <p class="saved-articles__keywords">По ключевым словам: <b id="keywords-showed">${e[0]}, ${e[1]}</b>\n        и <b id="keywords-counted">${e.length-2} другим</b>\n      </p>\n    `}renderResultsMarkUp(e){r.r.textContent="",r.r.insertAdjacentHTML("afterbegin",this._getResultsMarkUp(e))}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(1),s=n(0);class a extends r.a{constructor(e,t){let{headerColor:n,handlePopup:r}=e;super(),this.headerColor=n,this.handlePopup=r,this._cardClass=t}render(e){let{isLoggedin:t,userName:n}=e;"dark"===this.headerColor&&(s.b.classList.add("header_color_dark"),s.b.firstElementChild.insertAdjacentHTML("afterend",'\n<nav id="header-logged-in">\n  <ul class="header__nav">\n    <li><a class="link link_inactive" href="../">Главная</a></li>\n    <li><a class="link link_active" href="#">Сохранённые статьи</a></li>\n    <li>\n      <button type="button" class="header__button" id="logout-button">\n        <span class="header__username"></span>\n        <span class="header__button-icon"></span>\n      </button>\n    </li>\n  </ul>\n</nav>\n'),s.b.querySelector(".header__username").textContent=`${n}`,s.b.querySelector("#logout-button").onclick=()=>{this.closeMobileMenu(),window.location.href="../",this.logout()}),!1===t?(s.b.firstElementChild.insertAdjacentHTML("afterend",'\n<nav id="header-logged-out">\n  <ul class="header__nav">\n    <li><a class="link link_active" href="./">Главная</a></li>\n    <li>\n      <button type="button" class="header__button" id="auth-button">Авторизоваться</button>\n    </li>\n  </ul>\n</nav>\n'),s.b.querySelector("#auth-button").addEventListener("click",e=>{this.handlePopup(),this.closeMobileMenu()})):!0===t&&"main-regular"===this.headerColor&&(s.b.firstElementChild.insertAdjacentHTML("afterend",'\n<nav id="header-logged-in">\n  <ul class="header__nav">\n    <li><a class="link link_active" href="./">Главная</a></li>\n    <li><a class="link link_inactive" href="./news">Сохранённые статьи</a></li>\n    <li>\n      <button type="button" class="header__button" id="logout-button">\n        <span class="header__username"></span>\n        <img src="images/main-logout.png" alt="Кнопка логина">\n      </button>\n    </li>\n  </ul>\n</nav>\n'),s.b.querySelector(".header__username").textContent=`${n}`,s.b.querySelector("#logout-button").addEventListener("click",()=>{this.closeMobileMenu(),this.logout()}))}closeMobileMenu(){s.b.classList.contains("header_mobile")&&s.b.classList.remove("header_mobile")}logout(){s.b.removeChild(s.b.querySelector("#header-logged-in")),this.render({isLoggedin:!1}),localStorage.removeItem("user"),this._cardClass.renderCardIcons()}setEventListeners(){this._setHandlers([{element:s.d,event:"click",callback:e=>s.b.classList.toggle("header_mobile")}])}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),s=n(0);var a=n(2);class o extends r.a{constructor(e,t){super(),this._mainApi=e,this._profileClass=t,this.iconClickHandler=this.iconClickHandler.bind(this)}create(e,t,n,r,o,i,c,l,u){let{page:d}=c;const h=`\n    <div class="news-card" data-id="${u}" data-owner="">\n      <div class="news-card__header-wrapper">\n        <button class="news-card__icon ${"profile"===d?"news-card__icon_page_news":""}"></button>\n        <button class="news-card__tooltip ${"profile"===d?"news-card__tooltip_active news-card__tooltip_page_news":""}"></button>\n        ${"profile"===d?`<i class="news-card__theme">${Object(a.a)(l)}</i>`:""}\n      </div>\n      <img class="news-card__pic" alt="Картинка новости" src="${r}" onerror="this.src='https://leeford.in/wp-content/uploads/2017/09/image-not-found.jpg';">\n      <div class="news-card__content-wrapper">\n        <time class="news-card__date">${"profile"===d?t:function(e){const t=new Date(e),n=t.getFullYear();return`${t.toLocaleString("ru-RU",{month:"long",day:"numeric"})}, ${n}`}(t)}</time>\n        <h3 class="news-card__title">${e}</h3>\n        <p class="news-card__text">${n.replace(/([<ol>]+[<\/ol>]+[<li>]+[<\/li>]+)/g,"")}</p>\n        <a class="news-card__source" href="${i}" rel="noopener noreferrer" target="_blank">${o}</a>\n      </div>\n    </div>\n    `;s.a.insertAdjacentHTML("beforeend",h),this.renderCardIcons()}renderCardIcons(){const e=document.querySelectorAll(".news-card__tooltip"),t=document.querySelectorAll(".news-card__icon");JSON.parse(localStorage.getItem("user"))?(e.forEach(e=>e.classList.remove("news-card__tooltip_active")),t.forEach(e=>e.removeAttribute("disabled"))):(e.forEach(e=>e.classList.add("news-card__tooltip_active")),t.forEach(e=>e.setAttribute("disabled",!0)))}iconClickHandler(e){if(e.target.classList.contains("news-card__icon")){const t=e.target.closest(".news-card"),n={keyword:`${s.n?s.n.value:null}`,title:t.querySelector(".news-card__title").textContent,text:t.querySelector(".news-card__text").textContent,date:t.querySelector(".news-card__date").textContent,source:t.querySelector(".news-card__source").textContent,link:t.querySelector(".news-card__source").href,image:t.querySelector(".news-card__pic").src};if(e.target.classList.contains("news-card__icon_active")){const n=()=>{t.dataset.id="",t.dataset.owner="",e.target.classList.remove("news-card__icon_active")};this._mainApi.removeArticle(t.dataset.id,n)}else if(e.target.classList.contains("news-card__icon_page_news"))s.a.removeChild(t),this._mainApi.removeArticle(t.dataset.id,this._profileClass.renderResultsMarkUp);else{const r=n=>{t.dataset.id=n.article._id,t.dataset.owner=n.article.owner,e.target.classList.add("news-card__icon_active")};this._mainApi.createArticle(n,r)}}}setEventListeners(){this._setHandlers([{element:s.a,event:"click",callback:e=>this.iconClickHandler(e)}])}}},,function(e,t,n){"use strict";n.r(t);n(9);var r=n(5),s=n(0),a=n(4),o=n(3),i=n(6);const c=new o.a(s.c),l=new r.a({headerColor:"dark"}),u=new a.a(s.q),d=new i.a(c,u);s.q||(window.location.href="../"),c.getArticles().then(e=>{u.renderResultsMarkUp(e),e.forEach(e=>d.create(e.title,e.date,e.text,e.image,e.source,e.link,{page:"profile"},e.keyword,e._id))}),d.setEventListeners(),l.setEventListeners(),l.render({userName:s.q.name})},function(e,t,n){}]);