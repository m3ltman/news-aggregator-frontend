!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=10)}([function(e,t,s){"use strict";function n(e){return`${e.getFullYear().toString()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}s.d(t,"d",(function(){return r})),s.d(t,"b",(function(){return i})),s.d(t,"h",(function(){return o})),s.d(t,"g",(function(){return a})),s.d(t,"i",(function(){return c})),s.d(t,"c",(function(){return f})),s.d(t,"e",(function(){return g})),s.d(t,"n",(function(){return l})),s.d(t,"o",(function(){return u})),s.d(t,"a",(function(){return h})),s.d(t,"k",(function(){return d})),s.d(t,"j",(function(){return m})),s.d(t,"f",(function(){return v})),s.d(t,"m",(function(){return p})),s.d(t,"l",(function(){return _})),s.d(t,"p",(function(){return b})),s.d(t,"q",(function(){return w})),s.d(t,"r",(function(){return k}));const r=document.querySelector(".header__show-menu-btn"),i=document.querySelector(".header"),o=(document.querySelector("#logout-button"),document.querySelector(".popup-signup")),a=document.querySelector(".popup-signin"),c=document.querySelector(".popup-success"),l=(document.querySelector(".search__box"),document.querySelector(".search__bar")),u=document.querySelector(".search__button"),d=document.querySelector(".results"),h=document.querySelector(".cards"),p=document.querySelector(".results__success"),_=document.querySelector(".results__error"),m=document.querySelector(".preloader"),v=document.querySelector(".not-found"),b=document.querySelector(".results__show-button"),f={serverUrl:"https://api.news-aggregator.tk"},g={serverUrl:"https://praktikum.tk/news/v2/everything",apiKey:"8ed261fbbab34d4a85c2193047cedd72",userInput:l,today:n(new Date),aWeekAgo:function(){const e=new Date;return e.setDate(e.getDate()-7),n(e)}()},k=document.querySelector(".saved-articles"),w=JSON.parse(localStorage.getItem("user"))},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(){this._handlers=[]}_setHandlers(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(e=>this._setEventListener(e))}_setEventListener(e){let{element:t,event:s,callback:n}=e;t.addEventListener(s,n),this._handlers.push({element:t,event:s,callback:n})}removeEventListeners(){this._handlers.forEach(e=>{let{element:t,event:s,callback:n}=e;t.removeEventListener(s,n)})}}},function(e,t,s){"use strict";function n(e){return e[0].toUpperCase()+e.slice(1).toLowerCase()}s.d(t,"a",(function(){return n}))},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(e){this.serverUrl=e.serverUrl}signup(e,t,s,n,r){return fetch(`${this.serverUrl}/signup`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t,name:s})}).then(e=>e.ok?e.json():e.text().then(()=>{if(400===e.status)throw"Такой пользователь уже есть";throw"На сервере произошла ошибка"})).then(e=>(r(),e)).catch(e=>{n(e)})}signin(e,t,s,n){return fetch(`${this.serverUrl}/signin`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})}).then(e=>e.ok?e:e.text().then(()=>{if(401===e.status||400===e.status)throw"Ошибка авторизации, проверьте введённые данные";throw"На сервере произошла ошибка"})).then(e=>this.getUserData()).then(e=>{localStorage.setItem("user",JSON.stringify({name:e.name,email:e.email})),n(e.name)}).catch(e=>s(e))}getUserData(){return fetch(`${this.serverUrl}/users/me`,{credentials:"include",headers:{"Content-Type":"application/json"}}).then(e=>e.ok?e.json():Promise.reject(e.statusText)).then(e=>e).catch(e=>e)}getArticles(){return fetch(`${this.serverUrl}/articles`,{credentials:"include",headers:{"Content-Type":"application/json"}}).then(e=>e.ok?e.json():Promise.reject(e.statusText)).then(e=>e).catch(e=>console.log(e))}createArticle(e,t){return fetch(`${this.serverUrl}/articles`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyword:e.keyword,title:e.title,text:e.text,date:e.date,source:e.source,link:e.link,image:e.image})}).then(e=>e.ok?e.json():Promise.reject(e.statusText)).then(e=>{t(e)}).catch(e=>console.log(e))}removeArticle(e,t,s){return fetch(`${this.serverUrl}/articles/${e}`,{method:"DELETE",credentials:"include"}).then(e=>e.ok?e.json():Promise.reject(e.status)).then(e=>this.getArticles()).then(e=>{t?t(e):s()}).catch(e=>console.log(e))}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(0),r=s(2);class i{constructor(e){this.user=e,this.renderResultsMarkUp=this.renderResultsMarkUp.bind(this)}_getResultsMarkUp(e){const t=function(e){const t={};return e.forEach((function(e){t[e]=0})),e.filter((function(e){return 1==++t[e]})).sort((function(e,s){return t[s]-t[e]}))}(e.map(e=>Object(r.a)(e.keyword)));var s;return`\n      <h2 class="saved-articles__header">Сохранённые статьи</h2>\n      <p class="saved-articles__counter">${this.user.name}, у вас ${e.length} ${s=e.length,(s=Math.abs(s%100))>20&&(s%=10),["cохранённая статья","cохранённые статьи","cохранённых статей"][(s>4||0===s)+(1!==s)]}</p>\n      ${this.renderKeywords(t)}\n    `}renderKeywords(e){return e.length<=3?`<p class="saved-articles__keywords">По ключевым словам: <b id="keywords-showed">${e.join(", ")}</b>`:`\n      <p class="saved-articles__keywords">По ключевым словам: <b id="keywords-showed">${e[0]}, ${e[1]}</b>\n        и <b id="keywords-counted">${e.length-2} другим</b>\n      </p>\n    `}renderResultsMarkUp(e){n.r.textContent="",n.r.insertAdjacentHTML("afterbegin",this._getResultsMarkUp(e))}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(1),r=s(0);class i extends n.a{constructor(e,t){let{headerColor:s,handlePopup:n}=e;super(),this.headerColor=s,this.handlePopup=n,this._cardClass=t}render(e){let{isLoggedin:t,userName:s}=e;"dark"===this.headerColor&&(r.b.classList.add("header_color_dark"),r.b.firstElementChild.insertAdjacentHTML("afterend",'\n<nav id="header-logged-in">\n  <ul class="header__nav">\n    <li><a class="link link_inactive" href="../">Главная</a></li>\n    <li><a class="link link_active" href="#">Сохранённые статьи</a></li>\n    <li>\n      <button type="button" class="header__button" id="logout-button">\n        <span class="header__username"></span>\n        <span class="header__button-icon"></span>\n      </button>\n    </li>\n  </ul>\n</nav>\n'),r.b.querySelector(".header__username").textContent=`${s}`,r.b.querySelector("#logout-button").onclick=()=>{this.closeMobileMenu(),window.location.href="../",this.logout()}),!1===t?(r.b.firstElementChild.insertAdjacentHTML("afterend",'\n<nav id="header-logged-out">\n  <ul class="header__nav">\n    <li><a class="link link_active" href="./">Главная</a></li>\n    <li>\n      <button type="button" class="header__button" id="auth-button">Авторизоваться</button>\n    </li>\n  </ul>\n</nav>\n'),r.b.querySelector("#auth-button").addEventListener("click",e=>{this.handlePopup(),this.closeMobileMenu()})):!0===t&&"main-regular"===this.headerColor&&(r.b.firstElementChild.insertAdjacentHTML("afterend",'\n<nav id="header-logged-in">\n  <ul class="header__nav">\n    <li><a class="link link_active" href="./">Главная</a></li>\n    <li><a class="link link_inactive" href="./news">Сохранённые статьи</a></li>\n    <li>\n      <button type="button" class="header__button" id="logout-button">\n        <span class="header__username"></span>\n        <img src="images/main-logout.png" alt="Кнопка логина">\n      </button>\n    </li>\n  </ul>\n</nav>\n'),r.b.querySelector(".header__username").textContent=`${s}`,r.b.querySelector("#logout-button").addEventListener("click",()=>{this.closeMobileMenu(),this.logout()}))}closeMobileMenu(){r.b.classList.contains("header_mobile")&&r.b.classList.remove("header_mobile")}logout(){r.b.removeChild(r.b.querySelector("#header-logged-in")),this.render({isLoggedin:!1}),localStorage.removeItem("user"),this._cardClass.renderCardIcons()}setEventListeners(){this._setHandlers([{element:r.d,event:"click",callback:e=>r.b.classList.toggle("header_mobile")}])}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s(1),r=s(0);var i=s(2);class o extends n.a{constructor(e,t){super(),this._mainApi=e,this._profileClass=t,this.iconClickHandler=this.iconClickHandler.bind(this)}create(e,t,s,n,o,a,c,l,u){let{page:d}=c;const h=`\n    <div class="news-card" data-id="${u}" data-owner="">\n      <div class="news-card__header-wrapper">\n        <button class="news-card__icon ${"profile"===d?"news-card__icon_page_news":""}"></button>\n        <button class="news-card__tooltip ${"profile"===d?"news-card__tooltip_active news-card__tooltip_page_news":""}"></button>\n        ${"profile"===d?`<i class="news-card__theme">${Object(i.a)(l)}</i>`:""}\n      </div>\n      <img class="news-card__pic" alt="Картинка новости" src="${n}" onerror="this.src='https://leeford.in/wp-content/uploads/2017/09/image-not-found.jpg';">\n      <div class="news-card__content-wrapper">\n        <time class="news-card__date">${"profile"===d?t:function(e){const t=new Date(e),s=t.getFullYear();return`${t.toLocaleString("ru-RU",{month:"long",day:"numeric"})}, ${s}`}(t)}</time>\n        <h3 class="news-card__title">${e}</h3>\n        <p class="news-card__text">${s.replace(/([<ol>]+[<\/ol>]+[<li>]+[<\/li>]+)/g,"")}</p>\n        <a class="news-card__source" href="${a}" rel="noopener noreferrer" target="_blank">${o}</a>\n      </div>\n    </div>\n    `;r.a.insertAdjacentHTML("beforeend",h),this.renderCardIcons()}renderCardIcons(){const e=document.querySelectorAll(".news-card__tooltip"),t=document.querySelectorAll(".news-card__icon");JSON.parse(localStorage.getItem("user"))?(e.forEach(e=>e.classList.remove("news-card__tooltip_active")),t.forEach(e=>e.removeAttribute("disabled"))):(e.forEach(e=>e.classList.add("news-card__tooltip_active")),t.forEach(e=>e.setAttribute("disabled",!0)))}iconClickHandler(e){if(e.target.classList.contains("news-card__icon")){const t=e.target.closest(".news-card"),s={keyword:`${r.n?r.n.value:null}`,title:t.querySelector(".news-card__title").textContent,text:t.querySelector(".news-card__text").textContent,date:t.querySelector(".news-card__date").textContent,source:t.querySelector(".news-card__source").textContent,link:t.querySelector(".news-card__source").href,image:t.querySelector(".news-card__pic").src};if(e.target.classList.contains("news-card__icon_active")){const s=()=>{t.dataset.id="",t.dataset.owner="",e.target.classList.remove("news-card__icon_active")};this._mainApi.removeArticle(t.dataset.id,s)}else if(e.target.classList.contains("news-card__icon_page_news"))r.a.removeChild(t),this._mainApi.removeArticle(t.dataset.id,this._profileClass.renderResultsMarkUp);else{const n=s=>{t.dataset.id=s.article._id,t.dataset.owner=s.article.owner,e.target.classList.add("news-card__icon_active")};this._mainApi.createArticle(s,n)}}}setEventListeners(){this._setHandlers([{element:r.a,event:"click",callback:e=>this.iconClickHandler(e)}])}}},function(e,t,s){},,,function(e,t,s){"use strict";s.r(t);s(7);var n=s(5),r=s(1);function i(e){const t=e.querySelector(".button");t.classList.add("button_disabled"),t.setAttribute("disabled",!0)}function o(e){const t=e.querySelector(".button");t.classList.remove("button_disabled"),t.removeAttribute("disabled")}function a(e,t){e.parentNode.classList.contains(t)&&(e.parentNode.classList.remove(t),e.textContent="")}var c=s(0);class l extends r.a{constructor(e,t){super(),this._popup=e,this.formClass=t,this.form=this._popup.querySelector(".popup__form"),this.serverError=this._popup.querySelector(".popup__api-error"),this.switchBtn=this._popup.querySelector(".popup__switch-link"),this.closeBtn=this._popup.querySelector(".popup__close"),this.submitBtn=this._popup.querySelector(".button")}setServerError(e){this.serverError.textContent=e,this.serverError.classList.add("popup__api-error_visible")}open(e){e.classList.add("popup_is-opened"),this.setEventListeners(),c.d.setAttribute("style","display:none")}resetSubmitBtn(){let e=!0;for(const t of this.form)0!==t.name.length&&e&&(e=t.checkValidity());e?o(this.form):i(this.form)}clearContent(){this.form.querySelectorAll("input").forEach(e=>{a(e,"input-container_invalid")}),this.form.reset(),this.serverError.classList.contains("popup__api-error_visible")&&this.serverError.classList.remove("popup__api-error_visible"),i(this.form)}close(){this.clearContent(),this._popup.classList.remove("popup_is-opened"),c.d.removeAttribute("style","display:none")}_handleKeyDown(e){"Escape"===e.key&&this.close()}_handleMouseDown(e){e.target.classList.contains("popup_is-opened")&&this.close()}}class u extends r.a{constructor(e,t){super(),this.searchBtn=e,this.searchBar=t}_validateInputElement(e){const t=document.querySelector(`#error-${e.id}`);return!!e.checkValidity()||(t.textContent=e.validationMessage,function(e){e.parentNode.classList.add("input-container_invalid")}(e),!1)}validateForm(e){a(e.target,"input-container_invalid"),this._validateInputElement(e.target)}validateSearch(){return this.searchBar.checkValidity()?(this.searchBar.placeholder="Введите тему новости",this.searchBar.classList.remove("search__bar_invalid"),o(document.querySelector(".search__box")),!0):(this.searchBar.placeholder="Нужно ввести ключевое слово",this.searchBar.classList.add("search__bar_invalid"),i(document.querySelector(".search__box")),!1)}setEventListeners(){this._setHandlers([{element:this.searchBtn,event:"click",callback:e=>this.validateSearch()},{element:this.searchBar,event:"input",callback:e=>this.validateSearch()}])}}var d=s(3);var h=s(6);class p extends r.a{constructor(e,t,s){super(),this.card=e,this.newsApi=t,this.mainApi=s,this.renderResults=this.renderResults.bind(this),this.renderLoading=this.renderLoading.bind(this),this.articlesChunksCounter=0,this.chunkedArticles=[]}renderResults(e){0===e.length?(c.f.classList.add("not-found_visible"),c.m.classList.remove("results__success_visible"),c.l.classList.remove("results__error_visible")):(e.length>3&&c.p.classList.add("results__show-button_visible"),function(e,t){let s=0;for(;s<e.length;)t.push(e.slice(s,3+s)),s+=3}(e,this.chunkedArticles),this.addCard(this.chunkedArticles[0]),c.m.classList.add("results__success_visible"),c.f.classList.remove("not-found_visible"),c.l.classList.remove("results__error_visible"))}addCard(e){e.forEach(e=>{this.card.create(e.title,e.publishedAt,e.description,e.urlToImage,e.source.name,e.url,{page:"main"})})}renderLoading(e){e?(c.k.classList.add("results_hidden"),c.j.classList.add("preloader_visible")):(c.k.classList.remove("results_hidden"),c.j.classList.remove("preloader_visible"))}clearResults(){c.a.textContent="",this.chunkedArticles=[],this.articlesChunksCounter=0,c.p.classList.remove("results__show-button_visible")}renderError(e){c.m.classList.remove("results__success_visible"),c.f.classList.remove("not-found_visible"),c.l.textContent=e,c.l.classList.add("results__error_visible")}showMore(){const e=this.chunkedArticles[this.articlesChunksCounter+1];this.addCard(e),this.articlesChunksCounter+=1,this.articlesChunksCounter+1===this.chunkedArticles.length&&c.p.classList.remove("results__show-button_visible")}setEventListeners(){this._setHandlers([{element:c.o,event:"click",callback:e=>{this.clearResults(),this.renderLoading(!0),this.newsApi.getNews(this.renderResults,this.renderLoading,this.renderError)}},{element:c.p,event:"click",callback:e=>this.showMore()}])}}var _=s(4);const m=new class{constructor(e){let{serverUrl:t,apiKey:s,userInput:n,today:r,aWeekAgo:i}=e;this.serverUrl=t,this.apiKey=s,this.userInput=n,this.today=r,this.aWeekAgo=i}getNews(e,t,s){return fetch(`${this.serverUrl}?q=${this.userInput.value}&apiKey=${this.apiKey}&from=${this.today}&to=${this.aWeekAgo}&language=ru&pageSize=100`).then(e=>{if(e.ok)return e.json();throw"Во время запроса произошла ошибка. Возможно, проблема с соединением или сервер недоступен. Подождите немного и попробуйте ещё раз"}).then(t=>{!function(e){for(const t of e)null===t.urlToImage&&(t.urlToImage="https://leeford.in/wp-content/uploads/2017/09/image-not-found.jpg")}(t.articles),e(t.articles)}).catch(e=>s(e)).finally(e=>t(!1))}}(c.e),v=new d.a(c.c),b=new _.a(c.q),f=new h.a(v,b),g=new n.a({headerColor:"main-regular",handlePopup:function(){w.open(c.h),S.setEventListeners()}},f),k=new u(c.o,c.n),w=new class extends l{constructor(e,t,s,n,r){super(e,t),this.entrancePopUp=s,this.mainApi=n,this.successPopUp=r,this.setServerError=this.setServerError.bind(this),this.setSuccessPopUp=this.setSuccessPopUp.bind(this),this.close=this.close.bind(this)}setSuccessPopUp(){this.close(),this.open(this.successPopUp)}submit(e){e.preventDefault(),this.mainApi.signup(this.form.elements.email.value,this.form.elements.password.value,this.form.elements.name.value,this.setServerError,this.setSuccessPopUp)}setEventListeners(){this._setHandlers([{element:document,event:"keydown",callback:e=>this._handleKeyDown(e)},{element:document,event:"mousedown",callback:e=>this._handleMouseDown(e)},{element:this.closeBtn,event:"click",callback:e=>this.close()},{element:this.switchBtn,event:"click",callback:e=>{this.close(),this.open(this.entrancePopUp)}},{element:this.submitBtn,event:"click",callback:e=>this.submit(e)},{element:this.form,event:"input",callback:e=>{this.formClass.validateForm(e),this.resetSubmitBtn()}}])}}(c.h,k,c.g,v,c.i),y=(new class extends l{constructor(e,t){super(e),this.entrancePopUp=t,this.setEventListeners()}close(){this._popup.classList.remove("popup_is-opened")}setEventListeners(){this._setHandlers([{element:document,event:"keydown",callback:e=>this._handleKeyDown(e)},{element:document,event:"mousedown",callback:e=>this._handleMouseDown(e)},{element:this.closeBtn,event:"click",callback:e=>this.close()},{element:this.switchBtn,event:"click",callback:e=>{this.close(),this.open(this.entrancePopUp)}}])}}(c.i,c.g),new p(f,m,v)),S=new class extends l{constructor(e,t,s,n,r,i){super(e,t),this.registrationPopUp=s,this.mainApi=n,this.setServerError=this.setServerError.bind(this),this.setSuccessSignIn=this.setSuccessSignIn.bind(this),this._headerClass=r,this._cardClass=i}setSuccessSignIn(e){this.close(),c.b.removeChild(c.b.querySelector("nav")),this._headerClass.render({isLoggedin:!0,userName:e}),this._cardClass.renderCardIcons()}submit(e){e.preventDefault(),this.mainApi.signin(this.form.elements.email.value,this.form.elements.password.value,this.setServerError,this.setSuccessSignIn)}setEventListeners(){this._setHandlers([{element:document,event:"keydown",callback:e=>this._handleKeyDown(e)},{element:document,event:"mousedown",callback:e=>this._handleMouseDown(e)},{element:this.closeBtn,event:"click",callback:e=>this.close()},{element:this.switchBtn,event:"click",callback:e=>{this.close(),this.open(this.registrationPopUp)}},{element:this.submitBtn,event:"click",callback:e=>{this.submit(e)}},{element:this.form,event:"input",callback:e=>{this.formClass.validateForm(e),this.resetSubmitBtn()}}])}}(c.g,k,c.h,v,g,f);c.q?g.render({isLoggedin:!0,userName:c.q.name}):g.render({isLoggedin:!1}),g.setEventListeners(),k.setEventListeners(),y.setEventListeners(),f.setEventListeners()}]);